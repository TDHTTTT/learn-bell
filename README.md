# QOSF Mentorship Screening Task 2

My answer can be found in `learn-bell.ipynb` and `learn-bell.pdf`. Below is a short write-up which is also included in that jupyter notebook where the equations are properly rendered.

### Author
Tony Tong 

## Question
Task 2
Implement a circuit that returns |01> and |10> with equal probability.
Requirements :
The circuit should consist only of CNOTs, RXs and RYs. 
Start from all parameters in parametric gates being equal to 0 or randomly chosen. 
You should find the right set of parameters using gradient descent (you can use more advanced optimization methods if you like). 
Simulations must be done with sampling (i.e. a limited number of measurements per iteration) and noise. 

Compare the results for different numbers of measurements: 1, 10, 100, 1000. 

#### Bonus
How to make sure you produce state |01> + |10> and not |01> - |10> ?

(Actually for more careful readers, the “correct” version of this question is posted below:
How to make sure you produce state  |01⟩  +  |10⟩  and not any other combination of |01> + e(i phi)|10⟩ (for example |01⟩  -  |10⟩)?)

## Answer Summary

### Introduction
In a general 2-qubit system
$$\big|\psi\rangle=\alpha\big|00\rangle+\beta\big|01\rangle+\gamma\big|10\rangle+\delta\big|11\rangle$$

$$\left|\beta\right|^{2} = \left|\gamma\right|^{2} = 0.5$$


So in order to satisfy $\left|\beta\right|^{2} = \left|\gamma\right|^{2} = 0.5$:

$$q_1 = \big| 0 \rangle, q_2 = \big| 1 \rangle$$ $$q_1 = \big| 1 \rangle, q_2 = \big| 1 \rangle$$

When measuring in Z basis:
$$\langle 0\big| \sigma_z  \big| 0 \rangle = 1$$
$$\langle 1\big| \sigma_z  \big| 1 \rangle = -1$$


### Parametrized Models
Three parametrized quantum circuits (PQC) with different optimization methods, namely Rotosolve, Rotoselect [1] and QGAN [2], will be explored.

#### Rotosolve
Rotosolve will optimize a given parameters for a given circuit ansatz. The circuit ansatz chosen is made of 2 layers of single qubit Pauli-Y/X rotation and a CNOT block to entangle the 2 qubits so that it is expressible enough while having resonable noise.

The actual algorithm takes the advantage of the fact that the expectation value as a function of an angle of rotation has sinusoidal form. When optimizing, it finds the optimal angle for one gate when fixing all the others to the current value [1]. For a certain gate, the optimal angle has a closed form expression:

$$\begin{aligned}
\theta_{d}^{*} &=\arg \min _{\theta_{d}}\langle M\rangle_{\theta_{d}} \\
&=\phi-\frac{\pi}{2}-\arctan 2\left(2\langle M\rangle_{\theta_{d}=\phi}-\langle M\rangle_{\theta_{d}=\phi+\frac{\pi}{2}}-\langle M\rangle_{\theta_{d}=\phi-\frac{\pi}{2}}, \quad\langle M\rangle_{\theta_{d}=\phi+\frac{\pi}{2}}-\langle M\rangle_{\theta_{d}=\phi-\frac{\pi}{2}}\right)+2 \pi k
\end{aligned}$$

#### Rotoselect
Rotoselect builds on the Rotosolve algorithm, now the choice of the parametric gates themselves can also be optimized within the given set of gates(Rx, Ry in our case).

##### Loss fucntion for Rotosolve and Rotoselect
Since $q_1, q_2$ cancels each other in Z basis, we can choose our loss function for the opimizing algorithms:
$$L = \big|\langle q_1\big| \sigma_z  \big| q_1 \rangle + \langle q_2\big| \sigma_z  \big| q_2 \rangle\big|$$

#### QGAN
A quantum Generative Adversarial Network (qGAN) can learn the distribution of a particular smaple and load it into a quantum state [2].  

$$ \big| g_{\theta}\rangle = \sum_{j=0}^{2^n-1} \sqrt{p_{\theta}^{j}}\big| j \rangle $$

where $p_{\theta}^{j}$ describe the occurrence probabilities of the basis states $\big| j\rangle$. In our general two qubit system:

$$\big|\psi\rangle=\alpha\big|00\rangle+\beta\big|01\rangle+\gamma\big|10\rangle+\delta\big|11\rangle$$

where $\big| j\rangle\in \left\{\big|00\rangle, \big|01\rangle, \big|10\rangle, \big|11\rangle\right\}$.

So our goal is to train a quantum generator that can generate a state $\big| g_{\theta}\rangle$ where $p_{\theta}^{j} = 0.5$ if $\big| j\rangle \in \left\{\big|01\rangle, \big|10\rangle\right\}$.

As a result, the training data should follow a bimodal distribution where the two peaks is around $\big|01\rangle, \big|10\rangle$. It is worth noting that a GAN is well suited for generate both uni-modal and multi-modal distributions.

The qGAN in our case is made of two layers of $R_y$ gates and a CNOT gate in the middle for entanglement. The circuit diagram can be found below in the qGAN section.

##### Loss fucntion for qGAN
For the quantum generator:

$$L_G\left(\phi, \theta\right) = -\frac{1}{m}\sum\limits_{l=1}^{m}\left[\log\left(D_{\phi}\left(g^{l}\right)\right)\right]$$

and for the classical discriminator:

$$L_D\left(\phi, \theta\right) = \frac{1}{m}\sum\limits_{l=1}^{m}\left[\log D_{\phi}\left(x^{l}\right) + \log\left(1-D_{\phi}\left(g^{l}\right)\right)\right]$$

with $m$ denoting the batch size and $g^l$ describing the data samples generated by the quantum generator.

We can intuitively see that the generator would like to generate a state which cannot be distinguished by the discriminator.

### Metric
To evaluate the stability and accuracy of the models with different optimization methods, two metrics will be used:
1. The standard deviation of loss after 10 iterations
2. Mean squared error = $\frac{1}{2}[(\left|\beta\right|^{2} - 0.5)^2 + (\left|\gamma\right|^{2} - 0.5)^2]$

Note the second metric access the information in the state vector directly and thus is only possible to get in simulation.

Also, for qGAN, we only use MSE to evaluate its accuarcy. The stability of qGAN can be found in its loss plot.


### Result
Both Rotosovle and Rotoselect has decent accuracy (MSE < 0.012) with 1000 measurements. Also, they tend to optimize fairly quickly within a few iterations, which is better than gradient descent. On the other hand, in my experiements, Rotoselect's metrics behave similarly as Rotosolve's with respect to the numebr of measurements. Also note that Rotoselect's performance is about the same as Rotosolve's probably because that the circuit is simple. In fact in Fig.2 in the original paper [1], when working on VQE to minimize the energy, the Rotoseletct performs consistently better when the number of layers in the circuit is larger than 4.

qGAN also has decent accuracy (MSE=0.078). Both generator's and discriminator's losses are stable after ~100 iterations. Comparing to Rotosolve and Rotoselect, qGAN generates larger probabilities for $\big|00\rangle, \big|01\rangle$, probably becasue the training dataset, the bi-modal distribution built with two normal distribution has non-zero value in those region. If the standard deviation for the two normal distributions are made smaller, the qGAN might be able to produce better result.

The qGAN's performance might improve with a larger dataset and longer training time, but the training takes a long time. If time permits, more optimization and hyperparameter search should be tried. Also, it might be interesting to take advantage of GPU for the training.

#### Bonus
Due to time limit, the Bonus question, namely, how to produce that particular bell state without any local phase. If it has to be done with a variational circuit and parametric gates, then the loss function should be tweaked to discourage a local phase. On the other hand, if hand-craft gate is permitted, maybe some gates such as a phase kickback could be useful.

### References
[1] M. Ostaszewski, E. Grant, and M. Benedetti, Quantum Circuit Structure Learning, ArXiv:1905.09692 [Quant-Ph] (2019).

[2] C. Zoufal, A. Lucchi, and S. Woerner, Quantum Generative Adversarial Networks for Learning and Loading Random Distributions, Npj Quantum Inf 5, 103 (2019).
